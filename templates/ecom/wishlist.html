{% extends 'ecom/customer_base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2><i class="fas fa-heart text-danger"></i> My Wishlist</h2>
            <hr>
            
            {% if wishlist_items %}
            <div class="row">
                {% for item in wishlist_items %}
                <div class="col-md-4 col-lg-3 mb-4">
                    <div class="card h-100 wishlist-item" data-product-id="{{ item.product.id }}">
                        <div class="position-relative">
                            {% if item.product.product_image %}
                                <img src="{{ item.product.product_image.url }}" class="card-img-top" alt="{{ item.product.name }}" style="height: 250px; object-fit: cover;">
                            {% else %}
                                <img src="{% static 'images/default-product.jpg' %}" class="card-img-top" alt="{{ item.product.name }}" style="height: 250px; object-fit: cover;">
                            {% endif %}
                            
                            <!-- Remove from wishlist button -->
                            <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2 remove-wishlist-btn" 
                                    data-product-id="{{ item.product.id }}" 
                                    title="Remove from wishlist">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title">{{ item.product.name }}</h6>
            
                            <p class="card-text text-primary fw-bold">â‚±{{ item.product.price }}</p>
                            
                            <div class="mt-auto">
                                <a href="{% url 'product-detail' item.product.id %}" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="fas fa-eye"></i> View Details
                                </a>
                                <a href="{% url 'add-to-cart' item.product.id %}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-shopping-cart"></i> Add to Cart
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-heart-broken text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3 text-muted">Your wishlist is empty</h4>
                <p class="text-muted">Start adding products you love to your wishlist!</p>
                <a href="{% url 'customer-home' %}" class="btn btn-primary">
                    <i class="fas fa-shopping-bag"></i> Continue Shopping
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.wishlist-item {
    transition: transform 0.2s ease-in-out;
}

.wishlist-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.remove-wishlist-btn {
    opacity: 0.8;
    transition: opacity 0.2s;
}

.remove-wishlist-btn:hover {
    opacity: 1;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Remove from wishlist functionality
    document.querySelectorAll('.remove-wishlist-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            const productId = this.dataset.productId;
            const wishlistItem = this.closest('.wishlist-item');
            
            if (confirm('Are you sure you want to remove this item from your wishlist?')) {
                fetch(`/remove-from-wishlist/${productId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Animate removal
                        wishlistItem.style.transition = 'opacity 0.3s ease-out';
                        wishlistItem.style.opacity = '0';
                        
                        setTimeout(() => {
                            wishlistItem.remove();
                            
                            // Check if wishlist is now empty
                            const remainingItems = document.querySelectorAll('.wishlist-item');
                            if (remainingItems.length === 0) {
                                location.reload(); // Reload to show empty state
                            }
                        }, 300);
                    } else {
                        alert(data.message || 'Failed to remove item from wishlist');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while removing the item');
                });
            }
        });
    });
});
</script>
{% endblock %}